package org.opentestsystem.ap.contentspecid;

import static java.lang.String.format;
import static org.apache.commons.lang3.StringUtils.isBlank;

/**
 * Created by Greg Charles on 10/31/18.
 */
public enum ContentSpecGrade {
    UNSPECIFIED(-1),
    GK(0),   // Kindergarten
    G1(1),
    G2(2),
    G3(3),
    G4(4),
    G5(5),
    G6(6),
    G7(7),
    G8(8),
    GHS(11);   // High School

    private final int legacyValue;

    ContentSpecGrade(int legacyValue) {
        this.legacyValue = legacyValue;
    }

    public int getLegacyValue() {
        return legacyValue;
    }

    /**
     * Converts from a string to a ContentSpecGrade. Strings can any number in the range 1 to 12, or "K" or "HS", or
     * any of these preceded by a "G". E.g., 5 or G5, HS or GHS. Case is ignored. Left and right whitespace
     * padding is also ignored.
     *
     * @param s the string to convert
     * @return the converted grade or UNSPECIFIED if the conversion fails.
     */
    public static ContentSpecGrade fromString(String s) {
        if (isBlank(s)) {
            return UNSPECIFIED;
        }

        String gradeString = s.trim().toUpperCase();
        if (!gradeString.startsWith("G")) {
            gradeString = "G" + gradeString;
        }

        try {
            return valueOf(gradeString);
        } catch (IllegalArgumentException | NullPointerException e) {
            try {
                // Special handling for grades 0 and 9 - 12.
                int gradeLevel = Integer.parseInt(gradeString.substring(1));
                if (gradeLevel == 0) {
                    return GK;
                }
                if (gradeLevel >= 9 && gradeLevel <= 12) {
                    return GHS;
                }
            } catch (NumberFormatException nfe) {
                return UNSPECIFIED;
            }
        }

        return UNSPECIFIED;
    }
}
